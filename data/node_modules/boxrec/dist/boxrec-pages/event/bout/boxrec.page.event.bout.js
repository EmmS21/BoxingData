"use strict";var __extends=this&&this.__extends||function(){var o=function(e,t){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)};return function(e,t){function r(){this.constructor=e}o(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}}(),__decorate=this&&this.__decorate||function(e,t,r,o){var n,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,r,o);else for(var i=e.length-1;0<=i;i--)(n=e[i])&&(a=(s<3?n(a):3<s?n(t,r,a):n(t,r))||a);return 3<s&&a&&Object.defineProperty(t,r,a),a};Object.defineProperty(exports,"__esModule",{value:!0});var boxrec_common_tables_columns_class_1=require("../../../boxrec-common-tables/boxrec-common-tables-columns.class"),output_decorator_1=require("../../../decorators/output.decorator"),helpers_1=require("../../../helpers"),boxrec_constants_1=require("../../boxrec.constants"),boxrec_event_constants_1=require("../boxrec.event.constants"),boxrec_page_event_1=require("../boxrec.page.event"),BoxrecPageEventBout=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var h;return __extends(t,e),(h=t).parseOutcome=function(e){var t=helpers_1.trimRemoveLineBreaks(e).match(/^(\w+)\s(\w+)$/),r={outcome:null,outcomeByWayOf:null};if(t){var o=t[1],n=t[2],s=boxrec_event_constants_1.BoxingBoutOutcome;1<o.length?(r.outcomeByWayOf=s[o],r.outcome=boxrec_common_tables_columns_class_1.BoxrecCommonTablesColumnsClass.parseOutcome(n)):(r.outcomeByWayOf=s[n],r.outcome=boxrec_common_tables_columns_class_1.BoxrecCommonTablesColumnsClass.parseOutcome(o))}return r},Object.defineProperty(t.prototype,"date",{get:function(){var e=this.$(".page h2:nth-child(1) a").text();return e?(e=helpers_1.trimRemoveLineBreaks(e),new Date(e).toISOString().slice(0,10)):e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"division",{get:function(){return boxrec_common_tables_columns_class_1.BoxrecCommonTablesColumnsClass.parseDivision(this.parseDivision("division"))},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstBoxer",{get:function(){var e=this.parseBoxers("first");return boxrec_common_tables_columns_class_1.BoxrecCommonTablesColumnsClass.parseNameAndId(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstBoxerAge",{get:function(){return this.parseBoxerAge(1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstBoxerHeight",{get:function(){return this.parseBoxerHeight(1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstBoxerKOs",{get:function(){return this.getKOs(1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstBoxerLast6",{get:function(){return this.parseLast6Object(!0)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstBoxerPointsAfter",{get:function(){return this.parsePoints(!1,1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstBoxerRanking",{get:function(){return this.parseRankingData(1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstBoxerReach",{get:function(){return this.parseBoxerReach(1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstBoxerRecord",{get:function(){return this.getRecord(1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"firstBoxerStance",{get:function(){return this.parseBoxerStance(1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"judges",{get:function(){var u=this,l=[];return this.parseJudges().forEach(function(e){var t=u.$("<tr>"+e+"</tr>"),r={id:null,name:null,scorecard:[]},o=t.find("td:nth-child(1)").text(),n=t.find("td:nth-child(2)").html(),s=t.find("td:nth-child(3)").text();if(o&&(r.scorecard[0]=parseInt(o,10)),n){var a=boxrec_common_tables_columns_class_1.BoxrecCommonTablesColumnsClass.parseNameAndId(n),i=a.id,c=a.name;r.id=i,r.name=c}s&&(r.scorecard[1]=parseInt(s,10)),l.push(r)}),l},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"numberOfRounds",{get:function(){var e=this.parseDivision("numberOfRounds");return e?parseInt(e,10):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"outcome",{get:function(){var e={boxer:{id:null,name:null},outcome:null,outcomeByWayOf:null},t=this.getBoxersSideObjRow(),r=t[0].find(".textWon"),o=t[1].find(".textWon"),n=t[0].find(".textDrawn");if(1===r.length||1===o.length){var s="",a=void 0;if(a=1===r.length?(s=this.$.html(t[0].find(".personLink")[0]),r[0].children[0].data):(s=this.$.html(t[0].find(".personLink")[1]),o[0].children[0].data)){var i=this.parseOutcomeOfBout(a);e.outcome=i.outcome,e.outcomeByWayOf=i.outcomeByWayOf}var c=boxrec_common_tables_columns_class_1.BoxrecCommonTablesColumnsClass.parseNameAndId(s);e.boxer.id=c.id,e.boxer.name=c.name}else if(2===n.length){e.outcome=boxrec_constants_1.WinLossDraw.draw;var u=n[0].children[0].data;if(u){i=this.parseOutcomeOfBout(u);e.outcomeByWayOf=i.outcomeByWayOf}}return e},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"rating",{get:function(){var e=".fa-star",t=".fa-half-star",r=this.$(e+","+t).parents("div").html();return r?(r="<div>"+r+"</div>",boxrec_common_tables_columns_class_1.BoxrecCommonTablesColumnsClass.parseRating(r,e,t)):null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"referee",{get:function(){var e=this.$.html(this.$(".responseLessDataTable a:nth-child(1)").get(0));return boxrec_common_tables_columns_class_1.BoxrecCommonTablesColumnsClass.parseReferee(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondBoxer",{get:function(){var e=this.parseBoxers("second");return boxrec_common_tables_columns_class_1.BoxrecCommonTablesColumnsClass.parseNameAndId(e)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondBoxerAge",{get:function(){return this.parseBoxerAge(3)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondBoxerHeight",{get:function(){return this.parseBoxerHeight(3)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondBoxerKOs",{get:function(){return this.getKOs(3)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondBoxerLast6",{get:function(){return this.parseLast6Object(!1)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondBoxerPointsAfter",{get:function(){return this.parsePoints(!1,3)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondBoxerRanking",{get:function(){return this.parseRankingData(3)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondBoxerReach",{get:function(){return this.parseBoxerReach(3)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondBoxerRecord",{get:function(){return this.getRecord(3)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"secondBoxerStance",{get:function(){return this.parseBoxerStance(3)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"titles",{get:function(){var e=this.parseTitles();return boxrec_common_tables_columns_class_1.BoxrecCommonTablesColumnsClass.parseTitles(e||"")},enumerable:!0,configurable:!0}),t.prototype.getPeopleTable=function(){return this.$("h1").parent().find("table").last().find("tbody tr")},t.prototype.findColumnByText=function(r){var o=this;void 0===r&&(r="");var e=this.$("td b").filter(function(e,t){return o.$(t).text().trim()===r});if(1<e.length)throw new Error("found two columns with the same name, please report this");return e},t.prototype.getBoxersSideObjRow=function(){var r=this,o=[];return this.$("table .personLink").each(function(e,t){r.$(t).attr("href").includes("boxer")&&o.length<2&&o.push(r.$(t).parent().parent().parent())}),o},t.prototype.getKOs=function(e){var t=this.parseMiddleRowByText("KOs",e);return parseInt(t,10)},t.prototype.getRecord=function(e){var t=this.parseMiddleRowByText("won",e),r=this.parseMiddleRowByText("lost",e),o=this.parseMiddleRowByText("drawn",e);return{draw:parseInt(o,10),loss:parseInt(r,10),win:parseInt(t,10)}},t.prototype.parseBoxerAge=function(e){var t=this.parseMiddleRowByText("age",e);return t?parseInt(t,10):null},t.prototype.parseBoxerHeight=function(e){var t=this.parseMiddleRowByText("height",e);return t=helpers_1.trimRemoveLineBreaks(t),helpers_1.parseHeight(t)},t.prototype.parseBoxerReach=function(e){var t=this.parseMiddleRowByText("reach",e),r=null;if(t=helpers_1.trimRemoveLineBreaks(t)){var o=t.match(/^(\d{2})(¼|½|¾)?(?:″|\&\#x2033\;)\s(?:\/|\&\#xA0\;\s)\s(?:\/|\&\#xA0\;)?(\d{3})cm$/);if(o){var n=o[1],s=o[2],a=o[3],i=parseInt(n,10);s&&(i+=helpers_1.convertFractionsToNumber(s)),r=[i,parseInt(a,10)]}}return r},t.prototype.parseBoxerStance=function(e){var t=this.parseMiddleRowByText("stance",e);return t?helpers_1.trimRemoveLineBreaks(t):null},t.prototype.parseBoxers=function(e){var o=this,n=[],s=[];return this.$("table a").each(function(e,t){var r=o.$(t).attr("href");n.length<2&&r.includes("boxer")&&!s.find(function(e){return e===r})&&(s.push(r),n.push(o.$.html(o.$(t))))}),"first"===e&&n[0]?n[0]:"second"===e&&n[1]?n[1]:""},t.prototype.parseDivision=function(e){var t=this.$("h2").get(1);if(t){var r=t.children[0].data;if(r){var o=r.match(/^(\w+).*\,\s?(\d{1,2})?/);if(!o)return"";if("division"===e&&o[1])return o[1];if("numberOfRounds"===e&&o[2])return o[2]}}return""},t.prototype.parseJudges=function(){var o=this,e=this.$(".responseLessDataTable a"),n=[];return e.each(function(e,t){if(o.$(t).attr("href").includes("judge")){var r=o.$.html(o.$(t).parent().parent());n.push(r)}}),n},t.prototype.parseLast6=function(e){for(var t=this.parseMiddleRowByText("last 6"),r=[],o=0;o<6;o++){var n=(t=t.next()).find("td:nth-child(1) table"),s=t.find("td:nth-child(3) table");if(n&&"first"===e){var a=this.$.html(n);r.push(a)}if(s&&"second"===e){var i=this.$.html(s);r.push(i)}}return r},t.prototype.parseLast6Object=function(e){for(var t=[],r=0,o=this.parseLast6(e?"first":"second");r<o.length;r++){var n=o[r],s={date:null,id:null,name:null,outcome:null,outcomeByWayOf:null},a=this.$(n),i={id:null,name:null},c=null;if(e){var u=this.$.html(a.find("td:nth-child(1) a"));i=boxrec_common_tables_columns_class_1.BoxrecCommonTablesColumnsClass.parseNameAndId(u)}else c=a.find("td:nth-child(1) span").html();var l=this.$.html(a.find("td:nth-child(2) a")),p=boxrec_common_tables_columns_class_1.BoxrecCommonTablesColumnsClass.parseNameAndId(l).name;if(e)c=a.find("td:nth-child(3) span").html();else{u=this.$.html(a.find("td:nth-child(3) a"));i=boxrec_common_tables_columns_class_1.BoxrecCommonTablesColumnsClass.parseNameAndId(u)}if(c){var f=h.parseOutcome(c),d=f.outcome,m=f.outcomeByWayOf;s.outcome=d,s.outcomeByWayOf=m}s.id=i.id,s.name=i.name,p&&(s.date=p),t.push(s)}return t},t.prototype.parseMiddleRowByText=function(e,t){void 0===e&&(e=""),void 0===t&&(t=-1);var r=this.findColumnByText(e).parent().parent();return 0<=t?r.find("td:nth-child("+t+")").text():r},t.prototype.parseOutcomeOfBout=function(e){var t=e.split(" "),r=Object.keys(boxrec_event_constants_1.BoxingBoutOutcome).find(function(e){return e===t[1]});if(r){var o=boxrec_event_constants_1.BoxingBoutOutcome[r];return{outcome:boxrec_constants_1.WinLossDraw.win,outcomeByWayOf:o}}return{outcome:null,outcomeByWayOf:null}},t.prototype.parsePoints=function(e,t){void 0===e&&(e=!0);var r=e?"before fight":"after fight",o=this.parseMiddleRowByText(r,t).match(/[\d\,]+/);return o?(o[0]=o[0].replace(",",""),parseInt(o[0],10)):null},t.prototype.parseRanking=function(){var e=this.parseMiddleRowByText("ranking");return this.$.html(e.next())},t.prototype.parseRankingData=function(e){void 0===e&&(e=1);var t=this.$(this.parseRanking()).find("td:nth-child("+e+")");return t.text()?parseInt(t.text(),10):null},t.prototype.parseTitles=function(){return this.$(".titleColor").html()},t=h=__decorate([output_decorator_1.OutputGetter(["bouts","commission","date","division","doctors","firstBoxer","firstBoxerAge","firstBoxerHeight","firstBoxerKOs","firstBoxerLast6","firstBoxerPointsAfter","firstBoxerRanking","firstBoxerReach","firstBoxerRecord","firstBoxerStance","id","inspector","judges","location","matchmakers","media","numberOfBouts","numberOfRounds","outcome","promoters","rating","referee","secondBoxer","secondBoxerAge","secondBoxerHeight","secondBoxerKOs","secondBoxerLast6","secondBoxerPointsAfter","secondBoxerRanking","secondBoxerReach","secondBoxerRecord","secondBoxerStance","television","titles"])],t)}(boxrec_page_event_1.BoxrecPageEvent);exports.BoxrecPageEventBout=BoxrecPageEventBout;