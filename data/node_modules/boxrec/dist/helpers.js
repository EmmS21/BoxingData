"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var BoxrecCommonTableHeader,cheerio=require("cheerio"),querystring=require("querystring"),boxrec_event_constants_1=require("./boxrec-pages/event/boxrec.event.constants");function convertFractionsToNumber(e){switch(e){case"&#xBC;":case"¼":return.25;case"&#xBD;":case"½":return.5;case"&#xBE;":case"¾":return.75;default:return 0}}function trimRemoveLineBreaks(e){return e.trim().replace(/(?:\r\n|\r|\n)/g,"").replace(/\s{2,}/g," ")}function changeToCamelCase(e){var r=e.replace(/\s(\w)/g,function(e){return e[1].toUpperCase()});return""+r.charAt(0).toLowerCase()+r.slice(1)}function getColumnDataByColumnHeader(e,r,t,n){void 0===n&&(n=!0);var o=e(e("<div>").append(e("table").clone()).html()),a=r.findIndex(function(e){return e===t});if(-1<a){var i=o.find("tr:nth-child(1) td:nth-child("+(a+1)+")");if(n){var s=i.html();return s?trimRemoveLineBreaks(s):""}return trimRemoveLineBreaks(i.text())}return""}function getValueForHeadersArr(e,r,t){return e.some(function(e){return e===r})?t:r}function getTableColumnData(e,o,a){void 0===o&&(o=1),void 0===a&&(a=!1);var i=[];return e.clone().find("> tbody tr").each(function(e,r){var t=cheerio.load(r)(this).find("td:nth-child("+o+")"),n=a?t.html():t.text();n&&i.push(trimRemoveLineBreaks(exports.stripArrows(n)))}),i}function getHeaderColumnText(l,e){void 0===e&&(e=1);var d=[],m=l.clone().find("> thead:nth-child("+e+")");return m.find("th").each(function(e,r){var t=cheerio.load(r),n=trimRemoveLineBreaks(exports.stripArrows(t(this).text()));if(n.includes("lbs")||n.includes("kilos"))d.push(getValueForHeadersArr(d,BoxrecCommonTableHeader.firstFighterWeight,BoxrecCommonTableHeader.secondFighterWeight));else if("w-l-d"!==n)if("last 6"!==n)if("rating"!==n){if(0===n.length){var o=m.siblings("tbody").eq(0).find("tr:nth-child(1) td");1===o.length&&(o=m.siblings("tbody").eq(0).find("tr:nth-child(2) td"));var a=o.eq(e);if(!a.length)throw new Error("Could not get table body element");if(a.find(".star-icon").length||a.find(".fa-star").length)return void d.push(BoxrecCommonTableHeader.rating);if(a.find(".tick").length)return void d.push(BoxrecCommonTableHeader.tick);if(a.find("a[href*='/event/']").length)return void d.push(BoxrecCommonTableHeader.links);if(a.find(".boutResult").length)return void d.push(BoxrecCommonTableHeader.outcome);if(a.find(exports.locationFlagSelector).length)return void d.push(BoxrecCommonTableHeader.location);var i=trimRemoveLineBreaks(a.text());if(0<i.length&&!isNaN(i)||/[¼½¾]/.test(i))return void d.push(getValueForHeadersArr(d,BoxrecCommonTableHeader.firstFighterWeight,BoxrecCommonTableHeader.secondFighterWeight));if(1===t("<div>"+a.html()+"</div>").find(".personLink").length)return void d.push(getValueForHeadersArr(d,BoxrecCommonTableHeader.fighter,BoxrecCommonTableHeader.opponent));var s=getTableColumnData(l,e+1).filter(function(e,r,t){return t.indexOf(e)===r}),c=Object.keys(boxrec_event_constants_1.BoxingBoutOutcome),u=s.map(function(r){return c.findIndex(function(e){return e===r})});if(u.length)if(0<u.reduce(function(e,r){return e+r}))return void d.push(BoxrecCommonTableHeader.outcomeByWayOf)}d.push(n)}else{d.some(function(e){return e===BoxrecCommonTableHeader.firstRating})?d.push(BoxrecCommonTableHeader.secondRating):d.push(BoxrecCommonTableHeader.firstRating)}else d.some(function(e){return e===BoxrecCommonTableHeader.firstLast6})?d.push(BoxrecCommonTableHeader.secondLast6):d.push(BoxrecCommonTableHeader.firstLast6);else d.push(getValueForHeadersArr(d,BoxrecCommonTableHeader.record,BoxrecCommonTableHeader.secondRecord))}),d}exports.convertFractionsToNumber=convertFractionsToNumber,exports.trimRemoveLineBreaks=trimRemoveLineBreaks,exports.changeToCamelCase=changeToCamelCase,exports.getColumnDataByColumnHeader=getColumnDataByColumnHeader,function(e){e.age="age",e.career="career",e.date="date",e.day="day",e.debut="debut",e.division="division",e.fighter="fighter",e.firstLast6="firstLast6",e.firstFighterWeight="firstFighterWeight",e.firstRating="firstRating",e.links="links",e.location="location",e.miles="miles",e.name="name",e.outcome="outcome",e.opponent="opponent",e.outcomeByWayOf="outcomeByWayOf",e.points="points",e.rating="rating",e.residence="residence",e.result="result",e.rounds="rounds",e.secondLast6="secondLast6",e.secondFighterWeight="secondFighterWeight",e.secondRating="secondRating",e.secondRecord="secondw-l-d",e.sport="sport",e.stance="stance",e.record="w-l-d",e.sex="sex",e.tick="tick",e.venue="venue"}(BoxrecCommonTableHeader=exports.BoxrecCommonTableHeader||(exports.BoxrecCommonTableHeader={})),exports.getValueForHeadersArr=getValueForHeadersArr,exports.getTableColumnData=getTableColumnData,exports.getHeaderColumnText=getHeaderColumnText,exports.locationFlagSelector='*[class*="flag"]',exports.townRegionCountryRegex=/\?country=([A-Za-z]+)(?:(?:&|&amp;)region=([A-Za-z0-9]*))?(?:(?:&|&amp;)town=(\d+))?/,exports.stripCommas=function(e){return e.replace(/,/g,"")},exports.stripArrows=function(e){return e.replace(/[↕↓↑]/g,"")},exports.whatTypeOfLink=function(e){var r=e.match(/(\w+)\=(\w+)/g),n={country:null,region:null,town:null};if(r)for(var t=function(e){var r=querystring.parse(e),t=Object.keys(r).map(function(e){return[e,r[e]]})[0];n[t[0]]=t[1]},o=0,a=r;o<a.length;o++){t(a[o])}return n.country&&n.region&&n.town?"town":n.country&&n.region?"region":"country"},exports.getLocationValue=function(e,r){var t=e.match(/(\w+)=(\w+)/g);if(t)for(var n=0,o=t;n<o.length;n++){var a=o[n],i=querystring.parse(a),s=Object.keys(i);if(s[0]===r)return i[s[0]]}return null},exports.replaceWithWeight=function(e){return trimRemoveLineBreaks(e).replace(/(\w+)\sTitle$/i,"$1weight Title")},exports.parseHeight=function(e){if(e){var r=/^(\d)\′\s(\d+)(½)?\″\s+\/\s+(\d{3})cm$/;e.includes("#x2032")&&(r=/^(\d)\&\#x2032\;\s(\d{1,2})(\&\#xB[CDE]\;)?\&\#x2033\;\s\&\#xA0\;\s\/\s\&\#xA0\;\s(\d{3})cm$/);var t=e.match(r);if(t){var n=t[1],o=t[2],a=t[3],i=t[4],s=parseInt(o,10);return s+=convertFractionsToNumber(a),[parseInt(n,10),s,parseInt(i,10)]}}return null};